<!DOCTYPE html>
<html lang="en">
<head>
  <title>生成备料清单 | Nooae's blog</title>
  <meta charset="utf-8">
<meta name="description" content="import openpyxl from openpyxl.styles import Alignment, PatternFill, Font, Border, Side from openpyxl.utils import get_column_letter # 创建新的工作簿 wb = openpyxl.Workbook() # ========== 1. 创建备料清单（模板）工作表 ========== ws1 = wb.active ws1.title = "备料清单（模板）" # 设 …"><meta name="author" content="nooae">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="https://www.nooae.com/theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="https://www.nooae.com/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="https://www.nooae.com/favicon.ico" type="image/x-icon">
  <link href="https://www.nooae.com/" type="application/atom+xml" rel="alternate" title="Nooae's blog ATOM Feed" />
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="https://www.nooae.com">Nooae's blog</a></div>
  <div class="small">Good good study, day day up!</div>
    <div class="nav">
  <li><a href="https://www.nooae.com//">Home</a></li>
  <li><a href="https://www.nooae.com//archives.html">Archives</a></li>
    </div>
</div>
    <div id="main">
<h2><a href="https://www.nooae.com/f9a7d1f1.html">生成备料清单</a></h2>
<h5><i class="icon-feather"></i> 周四 15 一月 2026
<i class="icon-bookmarks"></i>
<span><a href="https://www.nooae.com/tag/openpyxl.html">openpyxl</a> / </span>
</h5>

<!-- 以下是正文，使用 Markdown 语法 -->

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">openpyxl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl.styles</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Alignment</span><span class="p">,</span><span class="w"> </span><span class="n">PatternFill</span><span class="p">,</span><span class="w"> </span><span class="n">Font</span><span class="p">,</span><span class="w"> </span><span class="n">Border</span><span class="p">,</span><span class="w"> </span><span class="n">Side</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl.utils</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">get_column_letter</span>

<span class="c1"># 创建新的工作簿</span>
<span class="n">wb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openpyxl</span><span class="o">.</span><span class="n">Workbook</span><span class="p">()</span>

<span class="c1"># ========== 1. 创建备料清单（模板）工作表 ==========</span>
<span class="n">ws1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">active</span>
<span class="n">ws1</span><span class="o">.</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;备料清单（模板）&quot;</span>

<span class="c1"># 设置列宽</span>
<span class="n">column_widths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;F&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span>
<span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">column_widths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span>

<span class="c1"># 设置行高</span>
<span class="n">row_heights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
<span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">row_heights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">row_dimensions</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span>

<span class="c1"># 设置边框样式</span>
<span class="n">thin_border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Border</span><span class="p">(</span>
<span class="w">    </span><span class="n">left</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;thin&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="n">right</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;thin&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="n">top</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;thin&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="n">bottom</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;thin&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># 设置颜色</span>
<span class="n">blue_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PatternFill</span><span class="p">(</span><span class="n">start_color</span><span class="o">=</span><span class="s2">&quot;B4C6E7&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_color</span><span class="o">=</span><span class="s2">&quot;B4C6E7&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill_type</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">)</span>
<span class="n">light_blue_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PatternFill</span><span class="p">(</span><span class="n">start_color</span><span class="o">=</span><span class="s2">&quot;D9E1F2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_color</span><span class="o">=</span><span class="s2">&quot;D9E1F2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill_type</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">)</span>
<span class="n">green_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PatternFill</span><span class="p">(</span><span class="n">start_color</span><span class="o">=</span><span class="s2">&quot;E2EFDA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_color</span><span class="o">=</span><span class="s2">&quot;E2EFDA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill_type</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">)</span>

<span class="c1"># 创建标题行</span>
<span class="n">ws1</span><span class="o">.</span><span class="n">merge_cells</span><span class="p">(</span><span class="s1">&#39;A1:I1&#39;</span><span class="p">)</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;=D2&amp;&quot;-&quot;&amp;H2&amp;&quot;备料清单&quot;&#39;</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blue_fill</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># 第二行</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;A2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;成品料号：&#39;</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;D2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;=TRIM(MID(SUBSTITUTE(工单BOM!A3,&quot;:&quot;,REPT(&quot; &quot;,100)),100,100))&#39;</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;计划数量：&#39;</span>
<span class="n">ws1</span><span class="p">[</span><span class="s1">&#39;H2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;=TRIM(MID(SUBSTITUTE(工单BOM!D4,&quot;:&quot;,REPT(&quot; &quot;,100)),100,100))&#39;</span>

<span class="k">for</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;A2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;H2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;I2&#39;</span><span class="p">]:</span>
<span class="w">    </span><span class="n">ws1</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ws1</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="w">    </span><span class="n">ws1</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light_blue_fill</span>
<span class="w">    </span><span class="n">ws1</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># 表头行（第三行）</span>
<span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;序号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;子件编码&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;子件名称&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;基本用量&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;需求数量&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="s1">&#39;库存数量&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;预估损耗&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;差异&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;调拨数量&#39;</span><span class="p">]</span>

<span class="k">for</span><span class="w"> </span><span class="n">col_idx</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">enumerate</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="n">col_idx</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
<span class="w">    </span><span class="n">cell</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">cell</span><span class="o">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="w">    </span><span class="n">cell</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">green_fill</span>
<span class="w">    </span><span class="n">cell</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># 创建数据行（第4行到第169行）</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">170</span><span class="p">):</span>
<span class="w">    </span><span class="n">row_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span>

<span class="w">    </span><span class="c1"># 序号</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">row</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 子件编码</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IF(ISBLANK(工单BOM!B</span><span class="si">{</span><span class="n">row</span><span class="o">+</span><span class="mi">4</span><span class="si">}</span><span class="s1">),&quot;&quot;,工单BOM!B</span><span class="si">{</span><span class="n">row</span><span class="o">+</span><span class="mi">4</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 子件名称</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IF(ISBLANK(工单BOM!C</span><span class="si">{</span><span class="n">row</span><span class="o">+</span><span class="mi">4</span><span class="si">}</span><span class="s1">),&quot;&quot;,TRIM(MID(SUBSTITUTE(工单BOM!C</span><span class="si">{</span><span class="n">row</span><span class="o">+</span><span class="mi">4</span><span class="si">}</span><span class="s1">,&quot;/&quot;,REPT(&quot; &quot;,100)),1,100)))&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 基本用量</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IF(ISBLANK(工单BOM!D</span><span class="si">{</span><span class="n">row</span><span class="o">+</span><span class="mi">4</span><span class="si">}</span><span class="s1">),&quot;&quot;,工单BOM!D</span><span class="si">{</span><span class="n">row</span><span class="o">+</span><span class="mi">4</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 需求数量</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IFERROR(D</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">*H$2,&quot;&quot;)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 库存数量</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IFERROR(VLOOKUP(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,库存数量!B:E,4,0),0)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 预估损耗</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IF(LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;413&quot;,0,IF(OR(LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;401&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;402&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;404&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;405&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;406&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;407&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;408&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;409&quot;,LEFT(B</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,3)=&quot;410&quot;),(E</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">*0.003+D</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">+50),(E</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">*0.003+10)))&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 差异</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=ROUNDUP(F</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">-E</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">-G</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,0)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 调拨数量</span>
<span class="w">    </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IF(-H</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">&lt;0,0,-H</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 设置样式</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ws1</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
<span class="w">        </span><span class="n">cell</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">cell</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># ========== 2. 创建工单BOM工作表 ==========</span>
<span class="n">ws2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="s2">&quot;工单BOM&quot;</span><span class="p">)</span>
<span class="c1"># 这是空的工作表，但保持结构</span>
<span class="n">ws2</span><span class="o">.</span><span class="n">sheet_view</span><span class="o">.</span><span class="n">showGridLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">False</span>

<span class="c1"># ========== 3. 创建库存数量工作表 ==========</span>
<span class="n">ws3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="s2">&quot;库存数量&quot;</span><span class="p">)</span>
<span class="c1"># 这是空的工作表</span>
<span class="n">ws3</span><span class="o">.</span><span class="n">sheet_view</span><span class="o">.</span><span class="n">showGridLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">False</span>

<span class="c1"># ========== 4. 创建发料清单工作表 ==========</span>
<span class="n">ws4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="s2">&quot;发料清单&quot;</span><span class="p">)</span>
<span class="c1"># 这是空的工作表</span>
<span class="n">ws4</span><span class="o">.</span><span class="n">sheet_view</span><span class="o">.</span><span class="n">showGridLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">False</span>

<span class="c1"># ========== 5. 创建料车位置工作表 ==========</span>
<span class="n">ws5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="s2">&quot;料车位置&quot;</span><span class="p">)</span>

<span class="c1"># 设置列宽</span>
<span class="n">column_widths_ws5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span>
<span class="p">}</span>
<span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">column_widths_ws5</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="w">    </span><span class="n">ws5</span><span class="o">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span>

<span class="c1"># 标题行</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;物料SN编码&#39;</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;B1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;子件编码&#39;</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;C1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;料车位置&#39;</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;E1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;料车位置查询&#39;</span>

<span class="c1"># 设置标题样式</span>
<span class="k">for</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E1&#39;</span><span class="p">]:</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blue_fill</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># 查询表头</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;E3&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;物料SN编码&#39;</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;子件编码&#39;</span>
<span class="n">ws5</span><span class="p">[</span><span class="s1">&#39;G3&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;料车位置&#39;</span>
<span class="k">for</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;E3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G3&#39;</span><span class="p">]:</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">green_fill</span>
<span class="w">    </span><span class="n">ws5</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># 创建映射数据行（第2行到第121行）</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">):</span>
<span class="w">    </span><span class="c1"># 子件编码公式</span>
<span class="w">    </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IFERROR(TRIM(MID(SUBSTITUTE(A</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,&quot;|&quot;,REPT(&quot; &quot;,100)),1,100)),&quot;&quot;)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 料车位置（固定位置，这里简单示例）</span>
<span class="w">    </span><span class="n">positions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;A11&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A12&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A13&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A14&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A21&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A22&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A23&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A24&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A25&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;A31&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A32&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A33&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A34&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A35&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A41&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A42&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A43&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A44&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A45&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;A51&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A52&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A53&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A54&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A55&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A61&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A62&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A63&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A64&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A65&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;B11&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B12&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B13&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B14&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B21&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B22&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B23&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B24&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B25&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;B31&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B32&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B33&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B34&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B35&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B41&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B42&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B43&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B44&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B45&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;B51&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B52&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B53&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B54&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B55&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B61&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B62&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B63&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B64&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B65&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;C11&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C12&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C13&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C14&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C21&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C22&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C23&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C24&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C25&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;C31&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C32&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C33&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C34&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C35&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C41&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C42&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C43&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C44&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C45&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;C51&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C52&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C53&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C54&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C55&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C61&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C62&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C63&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C64&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C65&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;D11&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D12&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D13&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D14&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D21&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D22&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D23&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D24&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D25&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;D31&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D32&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D33&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D34&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D35&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D41&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D42&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D43&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D44&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D45&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;D51&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D52&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D53&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D54&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D55&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D61&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D62&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D63&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D64&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D65&#39;</span><span class="p">]</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">row</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">):</span>
<span class="w">        </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="n">row</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># 创建查询区域（第4行到第121行）</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">):</span>
<span class="w">    </span><span class="c1"># 物料SN编码（用户输入区）</span>
<span class="w">    </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 子件编码公式</span>
<span class="w">    </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IFERROR(TRIM(MID(SUBSTITUTE(E</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,&quot;|&quot;,REPT(&quot; &quot;,100)),1,100)),&quot;&quot;)&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># 料车位置查询公式</span>
<span class="w">    </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;=IF(LEN(F</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">)=10,VLOOKUP(F</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s1">,B:C,2,0),&quot;&quot;)&#39;</span><span class="p">)</span>

<span class="c1"># 设置数据区域样式</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">):</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]:</span>
<span class="w">        </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
<span class="w">        </span><span class="n">cell</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">cell</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">):</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">]:</span>
<span class="w">        </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ws5</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
<span class="w">        </span><span class="n">cell</span><span class="o">.</span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">cell</span><span class="o">.</span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thin_border</span>

<span class="c1"># 保存文件</span>
<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;备料清单.xlsx&quot;</span>
<span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excel文件 &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; 已创建成功！&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;包含的工作表:&quot;</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">:</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">sheet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
     <li class="footer"><a href="https://www.nooae.com/tag/openpyxl.html">openpyxl&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="https://www.nooae.com/tag/pandas.html">pandas&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="https://www.nooae.com/tag/pyautogui.html">pyautogui&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="https://www.nooae.com/tag/qrcode.html">qrcode&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="https://www.nooae.com/tag/selenium.html">selenium&nbsp;&bull;&nbsp;</a></li>
     <li class="footer"><a href="https://www.nooae.com/tag/tkinter.html">tkinter</a></li>
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2014&nbsp;::</li>
    <li class="footer"><a href="https://www.nooae.com">Nooae's blog </a>&nbsp;::</li>
    <li class="footer">powered by <a href="https://github.com/getpelican">pelican</a>&nbsp;::</li>
    <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div></body>
</html>